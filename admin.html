<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Scott Friedman</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: #f5f5f5;
            color: #1a1a1a;
            line-height: 1.6;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        h2 { font-size: 1.1rem; margin: 2rem 0 1rem; color: #2d5a3d; }
        .subtitle { color: #666; margin-bottom: 2rem; }

        /* Login */
        #login-screen { text-align: center; padding: 4rem 2rem; }
        #login-screen input {
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 1rem;
        }
        #login-screen button {
            padding: 0.75rem 2rem;
            font-size: 1rem;
            background: #2d5a3d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        #login-screen button:hover { background: #1e3d29; }
        .error { color: #c45d3a; margin-top: 1rem; }

        /* Admin panel */
        #admin-panel { display: none; }
        .section {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #333;
        }
        input, textarea {
            width: 100%;
            padding: 0.6rem 0.8rem;
            font-size: 0.95rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-family: inherit;
        }
        textarea { min-height: 80px; resize: vertical; }
        input:focus, textarea:focus {
            outline: none;
            border-color: #2d5a3d;
        }

        /* Items list */
        .item {
            background: #f9f9f9;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            position: relative;
        }
        .item input, .item textarea { margin-bottom: 0.5rem; }
        .remove-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            color: #c45d3a;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem;
        }
        .remove-btn:hover { color: #a33d1a; }

        .add-btn {
            background: #f0f0f0;
            border: 2px dashed #ccc;
            padding: 0.75rem;
            border-radius: 8px;
            width: 100%;
            cursor: pointer;
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        .add-btn:hover { border-color: #2d5a3d; color: #2d5a3d; }

        /* Save button */
        .save-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        .save-btn {
            padding: 0.75rem 2rem;
            font-size: 1rem;
            background: #2d5a3d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .save-btn:hover { background: #1e3d29; }
        .save-btn:disabled { background: #999; cursor: not-allowed; }
        .status { padding: 0.75rem; color: #666; }
        .status.success { color: #2d5a3d; }
        .status.error { color: #c45d3a; }

        /* Logout */
        .logout-btn {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: none;
            border: 1px solid #ddd;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            color: #666;
        }
        .logout-btn:hover { border-color: #c45d3a; color: #c45d3a; }

        /* Space for save bar */
        body { padding-bottom: 5rem; }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen">
        <h1>Admin Login</h1>
        <p class="subtitle">Enter your password to manage content</p>
        <input type="password" id="password-input" placeholder="Password" autofocus>
        <br>
        <button onclick="login()">Login</button>
        <p id="login-error" class="error"></p>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel">
        <button class="logout-btn" onclick="logout()">Logout</button>

        <h1>Content Manager</h1>
        <p class="subtitle">Edit your website content below</p>

        <!-- About Section -->
        <div class="section">
            <h2>About</h2>
            <label>Paragraph 1</label>
            <textarea id="about-p1" placeholder="First paragraph..."></textarea>
            <label>Paragraph 2</label>
            <textarea id="about-p2" placeholder="Second paragraph..."></textarea>
        </div>

        <!-- Projects Section -->
        <div class="section">
            <h2>Projects</h2>
            <div id="projects-container"></div>
            <button class="add-btn" onclick="addProject()">+ Add Project</button>
        </div>

        <!-- Writing Section -->
        <div class="section">
            <h2>Writing</h2>
            <div id="writing-container"></div>
            <button class="add-btn" onclick="addWriting()">+ Add Post</button>
        </div>

        <!-- Mixes Section -->
        <div class="section">
            <h2>Mixes</h2>
            <p style="color: #666; font-size: 0.85rem; margin-bottom: 1rem;">
                Get embed URLs from Mixcloud: Share → Embed → copy the src URL from the iframe
            </p>
            <div id="mixes-container"></div>
            <button class="add-btn" onclick="addMix()">+ Add Mix</button>
        </div>
    </div>

    <!-- Save Bar -->
    <div class="save-bar" id="save-bar" style="display: none;">
        <button class="save-btn" onclick="saveContent()">Save Changes</button>
        <span id="save-status" class="status"></span>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Firebase config (same as main site)
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyCFKStIkbW_omKXd7TQb3jUVuBJA4g3zqo",
            authDomain: "scottfriedman-f400d.firebaseapp.com",
            databaseURL: "https://scottfriedman-f400d-default-rtdb.firebaseio.com",
            projectId: "scottfriedman-f400d",
            storageBucket: "scottfriedman-f400d.firebasestorage.app",
            messagingSenderId: "1046658110090",
            appId: "1:1046658110090:web:49a24a0ff13b19cb111373"
        };

        // Password (base64 encoded for minimal obfuscation)
        const PASSWORD = atob('cWpuTmdraTFST25E'); // qjnNgki1ROnD

        firebase.initializeApp(FIREBASE_CONFIG);
        const db = firebase.database();

        function login() {
            const pwd = document.getElementById('password-input').value;
            if (pwd === PASSWORD) {
                localStorage.setItem('admin_auth', 'true');
                showAdmin();
            } else {
                document.getElementById('login-error').textContent = 'Wrong password';
            }
        }

        function logout() {
            localStorage.removeItem('admin_auth');
            location.reload();
        }

        function showAdmin() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            document.getElementById('save-bar').style.display = 'flex';
            loadCurrentContent();
        }

        // Check auth on load
        document.getElementById('password-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') login();
        });

        if (localStorage.getItem('admin_auth') === 'true') {
            showAdmin();
        }

        // Content management
        let projects = [];
        let writing = [];
        let mixes = [];

        function loadCurrentContent() {
            db.ref('content').once('value').then((snapshot) => {
                const content = snapshot.val() || {};

                // About
                if (content.about && content.about.paragraphs) {
                    document.getElementById('about-p1').value = content.about.paragraphs[0] || '';
                    document.getElementById('about-p2').value = content.about.paragraphs[1] || '';
                }

                // Projects
                projects = content.projects || [];
                renderProjects();

                // Writing
                writing = content.writing || [];
                renderWriting();

                // Mixes
                mixes = content.mixes || [];
                renderMixes();
            });
        }

        // Projects
        function renderProjects() {
            const container = document.getElementById('projects-container');
            container.innerHTML = projects.map((p, i) => `
                <div class="item">
                    <button class="remove-btn" onclick="removeProject(${i})">×</button>
                    <input type="text" placeholder="Title" value="${p.title || ''}" onchange="projects[${i}].title = this.value">
                    <input type="text" placeholder="Description" value="${p.desc || ''}" onchange="projects[${i}].desc = this.value">
                    <input type="text" placeholder="Link (optional)" value="${p.link || ''}" onchange="projects[${i}].link = this.value">
                </div>
            `).join('');
        }

        function addProject() {
            projects.push({ title: '', desc: '', link: '' });
            renderProjects();
        }

        function removeProject(i) {
            projects.splice(i, 1);
            renderProjects();
        }

        // Writing
        function renderWriting() {
            const container = document.getElementById('writing-container');
            container.innerHTML = writing.map((w, i) => `
                <div class="item">
                    <button class="remove-btn" onclick="removeWriting(${i})">×</button>
                    <input type="text" placeholder="Date (e.g., 2024.12)" value="${w.date || ''}" onchange="writing[${i}].date = this.value">
                    <input type="text" placeholder="Title" value="${w.title || ''}" onchange="writing[${i}].title = this.value">
                    <input type="text" placeholder="Link (optional)" value="${w.link || ''}" onchange="writing[${i}].link = this.value">
                </div>
            `).join('');
        }

        function addWriting() {
            writing.push({ date: '', title: '', link: '' });
            renderWriting();
        }

        function removeWriting(i) {
            writing.splice(i, 1);
            renderWriting();
        }

        // Mixes
        function renderMixes() {
            const container = document.getElementById('mixes-container');
            container.innerHTML = mixes.map((m, i) => `
                <div class="item">
                    <button class="remove-btn" onclick="removeMix(${i})">×</button>
                    <input type="text" placeholder="Title (optional)" value="${m.title || ''}" onchange="mixes[${i}].title = this.value">
                    <input type="text" placeholder="Mixcloud Embed URL" value="${m.embedUrl || ''}" onchange="mixes[${i}].embedUrl = this.value">
                </div>
            `).join('');
        }

        function addMix() {
            mixes.push({ title: '', embedUrl: '' });
            renderMixes();
        }

        function removeMix(i) {
            mixes.splice(i, 1);
            renderMixes();
        }

        // Save
        function saveContent() {
            const status = document.getElementById('save-status');
            status.textContent = 'Saving...';
            status.className = 'status';

            const content = {
                about: {
                    paragraphs: [
                        document.getElementById('about-p1').value,
                        document.getElementById('about-p2').value
                    ].filter(p => p.trim())
                },
                projects: projects.filter(p => p.title.trim()),
                writing: writing.filter(w => w.title.trim()),
                mixes: mixes.filter(m => m.embedUrl.trim())
            };

            db.ref('content').set(content)
                .then(() => {
                    status.textContent = 'Saved!';
                    status.className = 'status success';
                    setTimeout(() => { status.textContent = ''; }, 2000);
                })
                .catch((err) => {
                    status.textContent = 'Error: ' + err.message;
                    status.className = 'status error';
                });
        }
    </script>
</body>
</html>
